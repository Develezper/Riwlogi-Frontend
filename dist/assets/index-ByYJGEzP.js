import{RangeSetBuilder as mt,RangeSet as Ht,EditorState as pe,Facet as X,StateField as Je,StateEffect as Oe,Prec as jt,combineConfig as kt,countColumn as Ut}from"./index-Cs5oz2oJ.js";import{V as Ke,t as $t,E as Q,G as qt,a as W,S as rt,p as Vt,W as yt,D as nt}from"./index-BN5dEhzL.js";const Gt=1024;let Jt=0;class Ee{constructor(e,t){this.from=e,this.to=t}}class b{constructor(e={}){this.id=Jt++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=z.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}b.closedBy=new b({deserialize:i=>i.split(" ")});b.openedBy=new b({deserialize:i=>i.split(" ")});b.group=new b({deserialize:i=>i.split(" ")});b.isolate=new b({deserialize:i=>{if(i&&i!="rtl"&&i!="ltr"&&i!="auto")throw new RangeError("Invalid value for isolate: "+i);return i||"auto"}});b.contextHash=new b({perNode:!0});b.lookAhead=new b({perNode:!0});b.mounted=new b({perNode:!0});class ge{constructor(e,t,r,n=!1){this.tree=e,this.overlay=t,this.parser=r,this.bracketed=n}static get(e){return e&&e.props&&e.props[b.mounted.id]}}const Kt=Object.create(null);class z{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):Kt,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new z(e.name||"",t,e.id,r);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(n)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(b.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return r=>{for(let n=r.prop(b.group),s=-1;s<(n?n.length:0);s++){let l=t[s<0?r.name:n[s]];if(l)return l}}}}z.none=new z("",Object.create(null),0,8);class bt{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let s of e){let l=s(r);if(l){n||(n=Object.assign({},r.props));let o=l[1],a=l[0];a.combine&&a.id in n&&(o=a.combine(n[a.id],o)),n[a.id]=o}}t.push(n?new z(r.name,n,r.id,r.flags):r)}return new bt(t)}}const we=new WeakMap,it=new WeakMap;var T;(function(i){i[i.ExcludeBuffers=1]="ExcludeBuffers",i[i.IncludeAnonymous=2]="IncludeAnonymous",i[i.IgnoreMounts=4]="IgnoreMounts",i[i.IgnoreOverlays=8]="IgnoreOverlays",i[i.EnterBracketed=16]="EnterBracketed"})(T||(T={}));class M{constructor(e,t,r,n,s){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,s&&s.length){this.props=Object.create(null);for(let[l,o]of s)this.props[typeof l=="number"?l:l.id]=o}}toString(){let e=ge.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let n=r.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new je(this.topNode,e)}cursorAt(e,t=0,r=0){let n=we.get(this)||this.topNode,s=new je(n);return s.moveTo(e,t),we.set(this,s._tree),s}get topNode(){return new E(this,0,0,null)}resolve(e,t=0){let r=me(we.get(this)||this.topNode,e,t,!1);return we.set(this,r),r}resolveInner(e,t=0){let r=me(it.get(this)||this.topNode,e,t,!0);return it.set(this,r),r}resolveStack(e,t=0){return Yt(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:s=this.length}=e,l=e.mode||0,o=(l&T.IncludeAnonymous)>0;for(let a=this.cursor(l|T.IncludeAnonymous);;){let f=!1;if(a.from<=s&&a.to>=n&&(!o&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;f=!0}for(;f&&r&&(o||!a.type.isAnonymous)&&r(a),!a.nextSibling();){if(!a.parent())return;f=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Ye(z.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,n)=>new M(this.type,t,r,n,this.propValues),e.makeTree||((t,r,n)=>new M(z.none,t,r,n)))}static build(e){return Zt(e)}}M.empty=new M(z.none,[],[],0);class Qe{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Qe(this.buffer,this.index)}}class te{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return z.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),e+=4,r==e)return s;let l=[];for(;e<r;)l.push(this.childString(e)),e=this.buffer[e+3];return s+"("+l.join(",")+")"}findChild(e,t,r,n,s){let{buffer:l}=this,o=-1;for(let a=e;a!=t&&!(xt(s,n,l[a+1],l[a+2])&&(o=a,r>0));a=l[a+3]);return o}slice(e,t,r){let n=this.buffer,s=new Uint16Array(t-e),l=0;for(let o=e,a=0;o<t;){s[a++]=n[o++],s[a++]=n[o++]-r;let f=s[a++]=n[o++]-r;s[a++]=n[o++]-e,l=Math.max(l,f)}return new te(s,l,this.set)}}function xt(i,e,t,r){switch(i){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function me(i,e,t,r){for(var n;i.from==i.to||(t<1?i.from>=e:i.from>e)||(t>-1?i.to<=e:i.to<e);){let l=!r&&i instanceof E&&i.index<0?null:i.parent;if(!l)return i;i=l}let s=r?0:T.IgnoreOverlays;if(r)for(let l=i,o=l.parent;o;l=o,o=l.parent)l instanceof E&&l.index<0&&((n=o.enter(e,t,s))===null||n===void 0?void 0:n.from)!=l.from&&(i=o);for(;;){let l=i.enter(e,t,s);if(!l)return i;i=l}}class wt{cursor(e=0){return new je(this,e)}getChild(e,t=null,r=null){let n=st(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return st(this,e,t,r)}resolve(e,t=0){return me(this,e,t,!1)}resolveInner(e,t=0){return me(this,e,t,!0)}matchContext(e){return He(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}get node(){return this}get next(){return this.parent}}class E extends wt{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,s=0){for(let l=this;;){for(let{children:o,positions:a}=l._tree,f=t>0?o.length:-1;e!=f;e+=t){let h=o[e],d=a[e]+l.from,g;if(!(!(s&T.EnterBracketed&&h instanceof M&&(g=ge.get(h))&&!g.overlay&&g.bracketed&&r>=d&&r<=d+h.length)&&!xt(n,r,d,d+h.length))){if(h instanceof te){if(s&T.ExcludeBuffers)continue;let k=h.findChild(0,h.buffer.length,t,r-d,n);if(k>-1)return new G(new Qt(l,h,e,d),null,k)}else if(s&T.IncludeAnonymous||!h.type.isAnonymous||Xe(h)){let k;if(!(s&T.IgnoreMounts)&&(k=ge.get(h))&&!k.overlay)return new E(k.tree,d,e,l);let w=new E(h,d,e,l);return s&T.IncludeAnonymous||!w.type.isAnonymous?w:w.nextChild(t<0?h.children.length-1:0,t,r,n,s)}}}if(s&T.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+t:e=t<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,r=0){let n;if(!(r&T.IgnoreOverlays)&&(n=ge.get(this._tree))&&n.overlay){let s=e-this.from,l=r&T.EnterBracketed&&n.bracketed;for(let{from:o,to:a}of n.overlay)if((t>0||l?o<=s:o<s)&&(t<0||l?a>=s:a>s))return new E(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function st(i,e,t,r){let n=i.cursor(),s=[];if(!n.firstChild())return s;if(t!=null){for(let l=!1;!l;)if(l=n.type.is(t),!n.nextSibling())return s}for(;;){if(r!=null&&n.type.is(r))return s;if(n.type.is(e)&&s.push(n.node),!n.nextSibling())return r==null?s:[]}}function He(i,e,t=e.length-1){for(let r=i;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class Qt{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class G extends wt{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new G(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,r=0){if(r&T.ExcludeBuffers)return null;let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new G(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new G(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new G(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,s=r.buffer[this.index+3];if(s>n){let l=r.buffer[this.index+1];e.push(r.slice(n,s,l)),t.push(0)}return new M(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function vt(i){if(!i.length)return null;let e=0,t=i[0];for(let s=1;s<i.length;s++){let l=i[s];(l.from>t.from||l.to<t.to)&&(t=l,e=s)}let r=t instanceof E&&t.index<0?null:t.parent,n=i.slice();return r?n[e]=r:n.splice(e,1),new Xt(n,t)}class Xt{constructor(e,t){this.heads=e,this.node=t}get next(){return vt(this.heads)}}function Yt(i,e,t){let r=i.resolveInner(e,t),n=null;for(let s=r instanceof E?r:r.context.parent;s;s=s.parent)if(s.index<0){let l=s.parent;(n||(n=[r])).push(l.resolve(e,t)),s=l}else{let l=ge.get(s.tree);if(l&&l.overlay&&l.overlay[0].from<=e&&l.overlay[l.overlay.length-1].to>=e){let o=new E(l.tree,l.overlay[0].from+s.from,-1,s);(n||(n=[r])).push(me(o,e,t,!1))}}return n?vt(n):r}class je{get name(){return this.type.name}constructor(e,t=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=t&~T.EnterBracketed,e instanceof E)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof E?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&T.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&T.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&T.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{let n=t.buffer[this.index+3];if(n<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(n.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let s=t+e,l=e<0?-1:r._tree.children.length;s!=l;s+=e){let o=r._tree.children[s];if(this.mode&T.IncludeAnonymous||o instanceof te||!o.type.isAnonymous||Xe(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let l=e;l;l=l._parent)if(l.index==n){if(n==this.index)return l;t=l,r=s+1;break e}n=this.stack[--s]}for(let n=r;n<this.stack.length;n++)t=new G(this.buffer,t,this.stack[n]);return this.bufferNode=new G(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return He(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return He(this._tree,e,n);let l=r[t.buffer[this.stack[s]]];if(!l.isAnonymous){if(e[n]&&e[n]!=l.name)return!1;n--}}return!0}}function Xe(i){return i.children.some(e=>e instanceof te||!e.type.isAnonymous||Xe(e))}function Zt(i){var e;let{buffer:t,nodeSet:r,maxBufferLength:n=Gt,reused:s=[],minRepeatType:l=r.types.length}=i,o=Array.isArray(t)?new Qe(t,t.length):t,a=r.types,f=0,h=0;function d(x,C,p,N,v,B){let{id:y,start:m,end:S,size:A}=o,O=h,Y=f;if(A<0)if(o.next(),A==-1){let K=s[y];p.push(K),N.push(m-x);return}else if(A==-3){f=y;return}else if(A==-4){h=y;return}else throw new RangeError(`Unrecognized record size: ${A}`);let ue=a[y],be,ne,et=m-x;if(S-m<=n&&(ne=R(o.pos-C,v))){let K=new Uint16Array(ne.size-ne.skip),F=o.pos-ne.size,U=K.length;for(;o.pos>F;)U=D(ne.start,K,U);be=new te(K,S-ne.start,r),et=ne.start-x}else{let K=o.pos-A;o.next();let F=[],U=[],ie=y>=l?y:-1,ae=0,xe=S;for(;o.pos>K;)ie>=0&&o.id==ie&&o.size>=0?(o.end<=xe-n&&(w(F,U,m,ae,o.end,xe,ie,O,Y),ae=F.length,xe=o.end),o.next()):B>2500?g(m,K,F,U):d(m,K,F,U,ie,B+1);if(ie>=0&&ae>0&&ae<F.length&&w(F,U,m,ae,m,xe,ie,O,Y),F.reverse(),U.reverse(),ie>-1&&ae>0){let tt=k(ue,Y);be=Ye(ue,F,U,0,F.length,0,S-m,tt,tt)}else be=P(ue,F,U,S-m,O-S,Y)}p.push(be),N.push(et)}function g(x,C,p,N){let v=[],B=0,y=-1;for(;o.pos>C;){let{id:m,start:S,end:A,size:O}=o;if(O>4)o.next();else{if(y>-1&&S<y)break;y<0&&(y=A-n),v.push(m,S,A),B++,o.next()}}if(B){let m=new Uint16Array(B*4),S=v[v.length-2];for(let A=v.length-3,O=0;A>=0;A-=3)m[O++]=v[A],m[O++]=v[A+1]-S,m[O++]=v[A+2]-S,m[O++]=O;p.push(new te(m,v[2]-S,r)),N.push(S-x)}}function k(x,C){return(p,N,v)=>{let B=0,y=p.length-1,m,S;if(y>=0&&(m=p[y])instanceof M){if(!y&&m.type==x&&m.length==v)return m;(S=m.prop(b.lookAhead))&&(B=N[y]+m.length+S)}return P(x,p,N,v,B,C)}}function w(x,C,p,N,v,B,y,m,S){let A=[],O=[];for(;x.length>N;)A.push(x.pop()),O.push(C.pop()+p-v);x.push(P(r.types[y],A,O,B-v,m-B,S)),C.push(v-p)}function P(x,C,p,N,v,B,y){if(B){let m=[b.contextHash,B];y=y?[m].concat(y):[m]}if(v>25){let m=[b.lookAhead,v];y=y?[m].concat(y):[m]}return new M(x,C,p,N,y)}function R(x,C){let p=o.fork(),N=0,v=0,B=0,y=p.end-n,m={size:0,start:0,skip:0};e:for(let S=p.pos-x;p.pos>S;){let A=p.size;if(p.id==C&&A>=0){m.size=N,m.start=v,m.skip=B,B+=4,N+=4,p.next();continue}let O=p.pos-A;if(A<0||O<S||p.start<y)break;let Y=p.id>=l?4:0,ue=p.start;for(p.next();p.pos>O;){if(p.size<0)if(p.size==-3||p.size==-4)Y+=4;else break e;else p.id>=l&&(Y+=4);p.next()}v=ue,N+=A,B+=Y}return(C<0||N==x)&&(m.size=N,m.start=v,m.skip=B),m.size>4?m:void 0}function D(x,C,p){let{id:N,start:v,end:B,size:y}=o;if(o.next(),y>=0&&N<l){let m=p;if(y>4){let S=o.pos-(y-4);for(;o.pos>S;)p=D(x,C,p)}C[--p]=m,C[--p]=B-x,C[--p]=v-x,C[--p]=N}else y==-3?f=N:y==-4&&(h=N);return p}let _=[],I=[];for(;o.pos>0;)d(i.start||0,i.bufferStart||0,_,I,-1,0);let j=(e=i.length)!==null&&e!==void 0?e:_.length?I[0]+_[0].length:0;return new M(a[i.topID],_.reverse(),I.reverse(),j)}const lt=new WeakMap;function Ne(i,e){if(!i.isAnonymous||e instanceof te||e.type!=i)return 1;let t=lt.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=i||!(r instanceof M)){t=1;break}t+=Ne(i,r)}lt.set(e,t)}return t}function Ye(i,e,t,r,n,s,l,o,a){let f=0;for(let w=r;w<n;w++)f+=Ne(i,e[w]);let h=Math.ceil(f*1.5/8),d=[],g=[];function k(w,P,R,D,_){for(let I=R;I<D;){let j=I,x=P[I],C=Ne(i,w[I]);for(I++;I<D;I++){let p=Ne(i,w[I]);if(C+p>=h)break;C+=p}if(I==j+1){if(C>h){let p=w[j];k(p.children,p.positions,0,p.children.length,P[j]+_);continue}d.push(w[j])}else{let p=P[I-1]+w[I-1].length-x;d.push(Ye(i,w,P,j,I,x,p,null,a))}g.push(x+_-s)}}return k(e,t,r,n,0),(o||a)(d,g,l)}class rn{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof G?this.setBuffer(e.context.buffer,e.index,t):e instanceof E&&this.map.set(e.tree,t)}get(e){return e instanceof G?this.getBuffer(e.context.buffer,e.index):e instanceof E?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class le{constructor(e,t,r,n,s=!1,l=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=(s?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let n=[new le(0,e.length,e,0,!1,r)];for(let s of t)s.to>e.length&&n.push(s);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],s=1,l=e.length?e[0]:null;for(let o=0,a=0,f=0;;o++){let h=o<t.length?t[o]:null,d=h?h.fromA:1e9;if(d-a>=r)for(;l&&l.from<d;){let g=l;if(a>=g.from||d<=g.to||f){let k=Math.max(g.from,a)-f,w=Math.min(g.to,d)-f;g=k>=w?null:new le(k,w,g.tree,g.offset+f,o>0,!!h)}if(g&&n.push(g),l.to>d)break;l=s<e.length?e[s++]:null}if(!h)break;a=h.toA,f=h.toA-h.toB}return n}}class er{startParse(e,t,r){return typeof e=="string"&&(e=new tr(e)),r=r?r.length?r.map(n=>new Ee(n.from,n.to)):[new Ee(0,0)]:[new Ee(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let s=n.advance();if(s)return s}}}class tr{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new b({perNode:!0});let rr=0;class L{constructor(e,t,r,n){this.name=e,this.set=t,this.base=r,this.modified=n,this.id=rr++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r=typeof e=="string"?e:"?";if(e instanceof L&&(t=e),t?.base)throw new Error("Can not derive from a modified tag");let n=new L(r,[],null,[]);if(n.set.push(n),t)for(let s of t.set)n.set.push(s);return n}static defineModifier(e){let t=new Be(e);return r=>r.modified.indexOf(t)>-1?r:Be.get(r.base||r,r.modified.concat(t).sort((n,s)=>n.id-s.id))}}let nr=0;class Be{constructor(e){this.name=e,this.instances=[],this.id=nr++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(o=>o.base==e&&ir(t,o.modified));if(r)return r;let n=[],s=new L(e.name,n,e,t);for(let o of t)o.instances.push(s);let l=sr(t);for(let o of e.set)if(!o.modified.length)for(let a of l)n.push(Be.get(o,a));return s}}function ir(i,e){return i.length==e.length&&i.every((t,r)=>t==e[r])}function sr(i){let e=[[]];for(let t=0;t<i.length;t++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(i[t]));return e.sort((t,r)=>r.length-t.length)}function lr(i){let e=Object.create(null);for(let t in i){let r=i[t];Array.isArray(r)||(r=[r]);for(let n of t.split(" "))if(n){let s=[],l=2,o=n;for(let d=0;;){if(o=="..."&&d>0&&d+3==n.length){l=1;break}let g=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!g)throw new RangeError("Invalid path: "+n);if(s.push(g[0]=="*"?"":g[0][0]=='"'?JSON.parse(g[0]):g[0]),d+=g[0].length,d==n.length)break;let k=n[d++];if(d==n.length&&k=="!"){l=0;break}if(k!="/")throw new RangeError("Invalid path: "+n);o=n.slice(d)}let a=s.length-1,f=s[a];if(!f)throw new RangeError("Invalid path: "+n);let h=new ke(r,l,a>0?s.slice(0,a):null);e[f]=h.sort(e[f])}}return St.add(e)}const St=new b({combine(i,e){let t,r,n;for(;i||e;){if(!i||e&&i.depth>=e.depth?(n=e,e=e.next):(n=i,i=i.next),t&&t.mode==n.mode&&!n.context&&!t.context)continue;let s=new ke(n.tags,n.mode,n.context);t?t.next=s:r=s,t=s}return r}});class ke{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}ke.empty=new ke([],2,null);function Ct(i,e){let t=Object.create(null);for(let s of i)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let l of s.tag)t[l.id]=s.class;let{scope:r,all:n=null}=e||{};return{style:s=>{let l=n;for(let o of s)for(let a of o.set){let f=t[a.id];if(f){l=l?l+" "+f:f;break}}return l},scope:r}}function or(i,e){let t=null;for(let r of i){let n=r.style(e);n&&(t=t?t+" "+n:n)}return t}function ar(i,e,t,r=0,n=i.length){let s=new fr(r,Array.isArray(e)?e:[e],t);s.highlightRange(i.cursor(),r,n,"",s.highlighters),s.flush(n)}class fr{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,n,s){let{type:l,from:o,to:a}=e;if(o>=r||a<=t)return;l.isTop&&(s=this.highlighters.filter(k=>!k.scope||k.scope(l)));let f=n,h=hr(e)||ke.empty,d=or(s,h.tags);if(d&&(f&&(f+=" "),f+=d,h.mode==1&&(n+=(n?" ":"")+d)),this.startSpan(Math.max(t,o),f),h.opaque)return;let g=e.tree&&e.tree.prop(b.mounted);if(g&&g.overlay){let k=e.node.enter(g.overlay[0].from+o,1),w=this.highlighters.filter(R=>!R.scope||R.scope(g.tree.type)),P=e.firstChild();for(let R=0,D=o;;R++){let _=R<g.overlay.length?g.overlay[R]:null,I=_?_.from+o:a,j=Math.max(t,D),x=Math.min(r,I);if(j<x&&P)for(;e.from<x&&(this.highlightRange(e,j,x,n,s),this.startSpan(Math.min(x,e.to),f),!(e.to>=I||!e.nextSibling())););if(!_||I>r)break;D=_.to+o,D>t&&(this.highlightRange(k.cursor(),Math.max(t,_.from+o),Math.min(r,D),"",w),this.startSpan(Math.min(r,D),f))}P&&e.parent()}else if(e.firstChild()){g&&(n="");do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,n,s),this.startSpan(Math.min(r,e.to),f)}while(e.nextSibling());e.parent()}}}function hr(i){let e=i.type.prop(St);for(;e&&e.context&&!i.matchContext(e.context);)e=e.next;return e||null}const u=L.define,ve=u(),Z=u(),ot=u(Z),at=u(Z),ee=u(),Se=u(ee),_e=u(ee),V=u(),se=u(V),$=u(),q=u(),Ue=u(),ce=u(Ue),Ce=u(),c={comment:ve,lineComment:u(ve),blockComment:u(ve),docComment:u(ve),name:Z,variableName:u(Z),typeName:ot,tagName:u(ot),propertyName:at,attributeName:u(at),className:u(Z),labelName:u(Z),namespace:u(Z),macroName:u(Z),literal:ee,string:Se,docString:u(Se),character:u(Se),attributeValue:u(Se),number:_e,integer:u(_e),float:u(_e),bool:u(ee),regexp:u(ee),escape:u(ee),color:u(ee),url:u(ee),keyword:$,self:u($),null:u($),atom:u($),unit:u($),modifier:u($),operatorKeyword:u($),controlKeyword:u($),definitionKeyword:u($),moduleKeyword:u($),operator:q,derefOperator:u(q),arithmeticOperator:u(q),logicOperator:u(q),bitwiseOperator:u(q),compareOperator:u(q),updateOperator:u(q),definitionOperator:u(q),typeOperator:u(q),controlOperator:u(q),punctuation:Ue,separator:u(Ue),bracket:ce,angleBracket:u(ce),squareBracket:u(ce),paren:u(ce),brace:u(ce),content:V,heading:se,heading1:u(se),heading2:u(se),heading3:u(se),heading4:u(se),heading5:u(se),heading6:u(se),contentSeparator:u(V),list:u(V),quote:u(V),emphasis:u(V),strong:u(V),link:u(V),monospace:u(V),strikethrough:u(V),inserted:u(),deleted:u(),changed:u(),invalid:u(),meta:Ce,documentMeta:u(Ce),annotation:u(Ce),processingInstruction:u(Ce),definition:L.defineModifier("definition"),constant:L.defineModifier("constant"),function:L.defineModifier("function"),standard:L.defineModifier("standard"),local:L.defineModifier("local"),special:L.defineModifier("special")};for(let i in c){let e=c[i];e instanceof L&&(e.name=i)}Ct([{tag:c.link,class:"tok-link"},{tag:c.heading,class:"tok-heading"},{tag:c.emphasis,class:"tok-emphasis"},{tag:c.strong,class:"tok-strong"},{tag:c.keyword,class:"tok-keyword"},{tag:c.atom,class:"tok-atom"},{tag:c.bool,class:"tok-bool"},{tag:c.url,class:"tok-url"},{tag:c.labelName,class:"tok-labelName"},{tag:c.inserted,class:"tok-inserted"},{tag:c.deleted,class:"tok-deleted"},{tag:c.literal,class:"tok-literal"},{tag:c.string,class:"tok-string"},{tag:c.number,class:"tok-number"},{tag:[c.regexp,c.escape,c.special(c.string)],class:"tok-string2"},{tag:c.variableName,class:"tok-variableName"},{tag:c.local(c.variableName),class:"tok-variableName tok-local"},{tag:c.definition(c.variableName),class:"tok-variableName tok-definition"},{tag:c.special(c.variableName),class:"tok-variableName2"},{tag:c.definition(c.propertyName),class:"tok-propertyName tok-definition"},{tag:c.typeName,class:"tok-typeName"},{tag:c.namespace,class:"tok-namespace"},{tag:c.className,class:"tok-className"},{tag:c.macroName,class:"tok-macroName"},{tag:c.propertyName,class:"tok-propertyName"},{tag:c.operator,class:"tok-operator"},{tag:c.comment,class:"tok-comment"},{tag:c.meta,class:"tok-meta"},{tag:c.invalid,class:"tok-invalid"},{tag:c.punctuation,class:"tok-punctuation"}]);var ze;const fe=new b;function ur(i){return X.define({combine:i?e=>e.concat(i):void 0})}const cr=new b;class H{constructor(e,t,r=[],n=""){this.data=e,this.name=n,pe.prototype.hasOwnProperty("tree")||Object.defineProperty(pe.prototype,"tree",{get(){return J(this)}}),this.parser=t,this.extension=[re.of(this),pe.languageData.of((s,l,o)=>{let a=ft(s,l,o),f=a.type.prop(fe);if(!f)return[];let h=s.facet(f),d=a.type.prop(cr);if(d){let g=a.resolve(l-a.from,o);for(let k of d)if(k.test(g,s)){let w=s.facet(k.facet);return k.type=="replace"?w:w.concat(h)}}return h})].concat(r)}isActiveAt(e,t,r=-1){return ft(e,t,r).type.prop(fe)==this.data}findRegions(e){let t=e.facet(re);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(s,l)=>{if(s.prop(fe)==this.data){r.push({from:l,to:l+s.length});return}let o=s.prop(b.mounted);if(o){if(o.tree.prop(fe)==this.data){if(o.overlay)for(let a of o.overlay)r.push({from:a.from+l,to:a.to+l});else r.push({from:l,to:l+s.length});return}else if(o.overlay){let a=r.length;if(n(o.tree,o.overlay[0].from+l),r.length>a)return}}for(let a=0;a<s.children.length;a++){let f=s.children[a];f instanceof M&&n(f,s.positions[a]+l)}};return n(J(e),0),r}get allowsNesting(){return!0}}H.setState=Oe.define();function ft(i,e,t){let r=i.facet(re),n=J(i).topNode;if(!r||r.allowsNesting)for(let s=n;s;s=s.enter(e,t,T.ExcludeBuffers|T.EnterBracketed))s.type.isTop&&(n=s);return n}class $e extends H{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=ur(e.languageData);return new $e(t,e.parser.configure({props:[fe.add(r=>r.isTop?t:void 0)]}),e.name)}configure(e,t){return new $e(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function J(i){let e=i.field(H.state,!1);return e?e.tree:M.empty}class dr{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let de=null;class Te{constructor(e,t,r=[],n,s,l,o,a){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=s,this.viewport=l,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new Te(e,t,[],M.empty,0,r,[],null)}startParse(){return this.parser.startParse(new dr(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=M.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(le.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(le.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=de;de=this;try{return e()}finally{de=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=ht(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:s,viewport:l,skipped:o}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((f,h,d,g)=>a.push({fromA:f,toA:h,fromB:d,toB:g})),r=le.applyChanges(r,a),n=M.empty,s=0,l={from:e.mapPos(l.from,-1),to:e.mapPos(l.to,1)},this.skipped.length){o=[];for(let f of this.skipped){let h=e.mapPos(f.from,1),d=e.mapPos(f.to,-1);h<d&&o.push({from:h,to:d})}}}return new Te(this.parser,t,r,n,s,l,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:s}=this.skipped[r];n<e.to&&s>e.from&&(this.fragments=ht(this.fragments,n,s),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends er{createParse(t,r,n){let s=n[0].from,l=n[n.length-1].to;return{parsedPos:s,advance(){let a=de;if(a){for(let f of n)a.tempSkipped.push(f);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=l,new M(z.none,[],[],l-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return de}}function ht(i,e,t){return le.applyChanges(i,[{fromA:e,toA:t,fromB:e,toB:t}])}class he{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new he(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=Te.create(e.facet(re).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new he(r)}}H.state=Je.define({create:he.init,update(i,e){for(let t of e.effects)if(t.is(H.setState))return t.value;return e.startState.facet(re)!=e.state.facet(re)?he.init(e.state):i.apply(e)}});let At=i=>{let e=setTimeout(()=>i(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(At=i=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(i,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Re=typeof navigator<"u"&&(!((ze=navigator.scheduling)===null||ze===void 0)&&ze.isInputPending)?()=>navigator.scheduling.isInputPending():null,pr=Ke.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(H.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(H.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=At(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,s=r.field(H.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let l=Date.now()+Math.min(this.chunkBudget,100,e&&!Re?Math.max(25,e.timeRemaining()-5):1e9),o=s.context.treeLen<n&&r.doc.length>n+1e3,a=s.context.work(()=>Re&&Re()||Date.now()>l,n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:H.setState.of(new he(s.context))})),this.chunkBudget>0&&!(a&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Vt(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),re=X.define({combine(i){return i.length?i[0]:null},enables:i=>[H.state,pr,Q.contentAttributes.compute([i],e=>{let t=e.facet(i);return t&&t.name?{"data-language":t.name}:{}})]});class sn{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const gr=X.define(),Nt=X.define({combine:i=>{if(!i.length)return"  ";let e=i[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(i[0]));return e}});function mr(i){let e=i.facet(Nt);return e.charCodeAt(0)==9?i.tabSize*e.length:e.length}function kr(i,e){let t="",r=i.tabSize,n=i.facet(Nt)[0];if(n=="	"){for(;e>=r;)t+="	",e-=r;n=" "}for(let s=0;s<e;s++)t+=n;return t}function yr(i,e){i instanceof pe&&(i=new Bt(i));for(let r of i.state.facet(gr)){let n=r(i,e);if(n!==void 0)return n}let t=J(i.state);return t.length>=e?xr(i,t,e):null}class Bt{constructor(e,t={}){this.state=e,this.options=t,this.unit=mr(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:s}=this.options;return n!=null&&n>=r.from&&n<=r.to?s&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.countColumn(r,e-n),l=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return l>-1&&(s+=l-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return Ut(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let l=s(n);if(l>-1)return l}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const br=new b;function xr(i,e,t){let r=e.resolveStack(t),n=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(n!=r.node){let s=[];for(let l=n;l&&!(l.from<r.node.from||l.to>r.node.to||l.from==r.node.from&&l.type==r.node.type);l=l.parent)s.push(l);for(let l=s.length-1;l>=0;l--)r={node:s[l],next:r}}return Tt(r,i,t)}function Tt(i,e,t){for(let r=i;r;r=r.next){let n=vr(r.node);if(n)return n(Ze.create(e,t,r))}return 0}function wr(i){return i.pos==i.options.simulateBreak&&i.options.simulateDoubleBreak}function vr(i){let e=i.type.prop(br);if(e)return e;let t=i.firstChild,r;if(t&&(r=t.type.prop(b.closedBy))){let n=i.lastChild,s=n&&r.indexOf(n.name)>-1;return l=>It(l,!0,1,void 0,s&&!wr(l)?n.from:void 0)}return i.parent==null?Sr:null}function Sr(){return 0}class Ze extends Bt{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new Ze(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(Cr(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return Tt(this.context.next,this.base,this.pos)}}function Cr(i,e){for(let t=e;t;t=t.parent)if(i==t)return!0;return!1}function Ar(i){let e=i.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let n=i.options.simulateBreak,s=i.state.doc.lineAt(t.from),l=n==null||n<=s.from?s.to:Math.min(s.to,n);for(let o=t.to;;){let a=e.childAfter(o);if(!a||a==r)return null;if(!a.type.isSkipped){if(a.from>=l)return null;let f=/^ */.exec(s.text.slice(t.to-s.from))[0].length;return{from:t.from,to:t.to+f}}o=a.to}}function ln({closing:i,align:e=!0,units:t=1}){return r=>It(r,e,t,i)}function It(i,e,t,r,n){let s=i.textAfter,l=s.match(/^\s*/)[0].length,o=r&&s.slice(l,l+r.length)==r||n==i.pos+l,a=e?Ar(i):null;return a?o?i.column(a.from):i.column(a.to):i.baseIndent+(o?0:i.unit*t)}const on=i=>i.baseIndent;function an({except:i,units:e=1}={}){return t=>{let r=i&&i.test(t.textAfter);return t.baseIndent+(r?0:e*t.unit)}}const Nr=200;function fn(){return pe.transactionFilter.of(i=>{if(!i.docChanged||!i.isUserEvent("input.type")&&!i.isUserEvent("input.complete"))return i;let e=i.startState.languageDataAt("indentOnInput",i.startState.selection.main.head);if(!e.length)return i;let t=i.newDoc,{head:r}=i.newSelection.main,n=t.lineAt(r);if(r>n.from+Nr)return i;let s=t.sliceString(n.from,r);if(!e.some(f=>f.test(s)))return i;let{state:l}=i,o=-1,a=[];for(let{head:f}of l.selection.ranges){let h=l.doc.lineAt(f);if(h.from==o)continue;o=h.from;let d=yr(l,h.from);if(d==null)continue;let g=/^\s*/.exec(h.text)[0],k=kr(l,d);g!=k&&a.push({from:h.from,to:h.from+g.length,insert:k})}return a.length?[i,{changes:a,sequential:!0}]:i})}const Br=X.define(),Tr=new b;function hn(i){let e=i.firstChild,t=i.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?i.to:t.from}:null}function Ir(i,e,t){let r=J(i);if(r.length<t)return null;let n=r.resolveStack(t,1),s=null;for(let l=n;l;l=l.next){let o=l.node;if(o.to<=t||o.from>t)continue;if(s&&o.from<e)break;let a=o.type.prop(Tr);if(a&&(o.to<r.length-50||r.length==i.doc.length||!Pr(o))){let f=a(o,i);f&&f.from<=t&&f.from>=e&&f.to>t&&(s=f)}}return s}function Pr(i){let e=i.lastChild;return e&&e.to==i.to&&e.type.isError}function Ie(i,e,t){for(let r of i.facet(Br)){let n=r(i,e,t);if(n)return n}return Ir(i,e,t)}function Pt(i,e){let t=e.mapPos(i.from,1),r=e.mapPos(i.to,-1);return t>=r?void 0:{from:t,to:r}}const Me=Oe.define({map:Pt}),ye=Oe.define({map:Pt});function Ot(i){let e=[];for(let{head:t}of i.state.selection.ranges)e.some(r=>r.from<=t&&r.to>=t)||e.push(i.lineBlockAt(t));return e}const oe=Je.define({create(){return W.none},update(i,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,r)=>i=ut(i,t,r)),i=i.map(e.changes);for(let t of e.effects)if(t.is(Me)&&!Or(i,t.value.from,t.value.to)){let{preparePlaceholder:r}=e.state.facet(Et),n=r?W.replace({widget:new Rr(r(e.state,t.value))}):ct;i=i.update({add:[n.range(t.value.from,t.value.to)]})}else t.is(ye)&&(i=i.update({filter:(r,n)=>t.value.from!=r||t.value.to!=n,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(i=ut(i,e.selection.main.head)),i},provide:i=>Q.decorations.from(i),toJSON(i,e){let t=[];return i.between(0,e.doc.length,(r,n)=>{t.push(r,n)}),t},fromJSON(i){if(!Array.isArray(i)||i.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<i.length;){let r=i[t++],n=i[t++];if(typeof r!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(ct.range(r,n))}return W.set(e,!0)}});function ut(i,e,t=e){let r=!1;return i.between(e,t,(n,s)=>{n<t&&s>e&&(r=!0)}),r?i.update({filterFrom:e,filterTo:t,filter:(n,s)=>n>=t||s<=e}):i}function Pe(i,e,t){var r;let n=null;return(r=i.field(oe,!1))===null||r===void 0||r.between(e,t,(s,l)=>{(!n||n.from>s)&&(n={from:s,to:l})}),n}function Or(i,e,t){let r=!1;return i.between(e,e,(n,s)=>{n==e&&s==t&&(r=!0)}),r}function Mt(i,e){return i.field(oe,!1)?e:e.concat(Oe.appendConfig.of(_t()))}const Mr=i=>{for(let e of Ot(i)){let t=Ie(i.state,e.from,e.to);if(t)return i.dispatch({effects:Mt(i.state,[Me.of(t),Dt(i,t)])}),!0}return!1},Dr=i=>{if(!i.state.field(oe,!1))return!1;let e=[];for(let t of Ot(i)){let r=Pe(i.state,t.from,t.to);r&&e.push(ye.of(r),Dt(i,r,!1))}return e.length&&i.dispatch({effects:e}),e.length>0};function Dt(i,e,t=!0){let r=i.state.doc.lineAt(e.from).number,n=i.state.doc.lineAt(e.to).number;return Q.announce.of(`${i.state.phrase(t?"Folded lines":"Unfolded lines")} ${r} ${i.state.phrase("to")} ${n}.`)}const Er=i=>{let{state:e}=i,t=[];for(let r=0;r<e.doc.length;){let n=i.lineBlockAt(r),s=Ie(e,n.from,n.to);s&&t.push(Me.of(s)),r=(s?i.lineBlockAt(s.to):n).to+1}return t.length&&i.dispatch({effects:Mt(i.state,t)}),!!t.length},_r=i=>{let e=i.state.field(oe,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,i.state.doc.length,(r,n)=>{t.push(ye.of({from:r,to:n}))}),i.dispatch({effects:t}),!0},un=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Mr},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:Dr},{key:"Ctrl-Alt-[",run:Er},{key:"Ctrl-Alt-]",run:_r}],zr={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},Et=X.define({combine(i){return kt(i,zr)}});function _t(i){return[oe,Lr]}function zt(i,e){let{state:t}=i,r=t.facet(Et),n=l=>{let o=i.lineBlockAt(i.posAtDOM(l.target)),a=Pe(i.state,o.from,o.to);a&&i.dispatch({effects:ye.of(a)}),l.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(i,n,e);let s=document.createElement("span");return s.textContent=r.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}const ct=W.replace({widget:new class extends yt{toDOM(i){return zt(i,null)}}});class Rr extends yt{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return zt(e,this.value)}}const Fr={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Fe extends qt{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function cn(i={}){let e={...Fr,...i},t=new Fe(e,!0),r=new Fe(e,!1),n=Ke.fromClass(class{constructor(l){this.from=l.viewport.from,this.markers=this.buildMarkers(l)}update(l){(l.docChanged||l.viewportChanged||l.startState.facet(re)!=l.state.facet(re)||l.startState.field(oe,!1)!=l.state.field(oe,!1)||J(l.startState)!=J(l.state)||e.foldingChanged(l))&&(this.markers=this.buildMarkers(l.view))}buildMarkers(l){let o=new mt;for(let a of l.viewportLineBlocks){let f=Pe(l.state,a.from,a.to)?r:Ie(l.state,a.from,a.to)?t:null;f&&o.add(a.from,a.from,f)}return o.finish()}}),{domEventHandlers:s}=e;return[n,$t({class:"cm-foldGutter",markers(l){var o;return((o=l.plugin(n))===null||o===void 0?void 0:o.markers)||Ht.empty},initialSpacer(){return new Fe(e,!1)},domEventHandlers:{...s,click:(l,o,a)=>{if(s.click&&s.click(l,o,a))return!0;let f=Pe(l.state,o.from,o.to);if(f)return l.dispatch({effects:ye.of(f)}),!0;let h=Ie(l.state,o.from,o.to);return h?(l.dispatch({effects:Me.of(h)}),!0):!1}}}),_t()]}const Lr=Q.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class De{constructor(e,t){this.specs=e;let r;function n(o){let a=rt.newName();return(r||(r=Object.create(null)))["."+a]=o,a}const s=typeof t.all=="string"?t.all:t.all?n(t.all):void 0,l=t.scope;this.scope=l instanceof H?o=>o.prop(fe)==l.data:l?o=>o==l:void 0,this.style=Ct(e.map(o=>({tag:o.tag,class:o.class||n(Object.assign({},o,{tag:null}))})),{all:s}).style,this.module=r?new rt(r):null,this.themeType=t.themeType}static define(e,t){return new De(e,t||{})}}const qe=X.define(),Rt=X.define({combine(i){return i.length?[i[0]]:null}});function Le(i){let e=i.facet(qe);return e.length?e:i.facet(Rt)}function dn(i,e){let t=[Hr],r;return i instanceof De&&(i.module&&t.push(Q.styleModule.of(i.module)),r=i.themeType),e?.fallback?t.push(Rt.of(i)):r?t.push(qe.computeN([Q.darkTheme],n=>n.facet(Q.darkTheme)==(r=="dark")?[i]:[])):t.push(qe.of(i)),t}class Wr{constructor(e){this.markCache=Object.create(null),this.tree=J(e.state),this.decorations=this.buildDeco(e,Le(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=J(e.state),r=Le(e.state),n=r!=Le(e.startState),{viewport:s}=e.view,l=e.changes.mapPos(this.decoratedTo,1);t.length<s.to&&!n&&t.type==this.tree.type&&l>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=l):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=s.to)}buildDeco(e,t){if(!t||!this.tree.length)return W.none;let r=new mt;for(let{from:n,to:s}of e.visibleRanges)ar(this.tree,t,(l,o,a)=>{r.add(l,o,this.markCache[a]||(this.markCache[a]=W.mark({class:a})))},n,s);return r.finish()}}const Hr=jt.high(Ke.fromClass(Wr,{decorations:i=>i.decorations})),pn=De.define([{tag:c.meta,color:"#404740"},{tag:c.link,textDecoration:"underline"},{tag:c.heading,textDecoration:"underline",fontWeight:"bold"},{tag:c.emphasis,fontStyle:"italic"},{tag:c.strong,fontWeight:"bold"},{tag:c.strikethrough,textDecoration:"line-through"},{tag:c.keyword,color:"#708"},{tag:[c.atom,c.bool,c.url,c.contentSeparator,c.labelName],color:"#219"},{tag:[c.literal,c.inserted],color:"#164"},{tag:[c.string,c.deleted],color:"#a11"},{tag:[c.regexp,c.escape,c.special(c.string)],color:"#e40"},{tag:c.definition(c.variableName),color:"#00f"},{tag:c.local(c.variableName),color:"#30a"},{tag:[c.typeName,c.namespace],color:"#085"},{tag:c.className,color:"#167"},{tag:[c.special(c.variableName),c.macroName],color:"#256"},{tag:c.definition(c.propertyName),color:"#00c"},{tag:c.comment,color:"#940"},{tag:c.invalid,color:"#f00"}]),jr=Q.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),Ft=1e4,Lt="()[]{}",Wt=X.define({combine(i){return kt(i,{afterCursor:!0,brackets:Lt,maxScanDistance:Ft,renderMatch:qr})}}),Ur=W.mark({class:"cm-matchingBracket"}),$r=W.mark({class:"cm-nonmatchingBracket"});function qr(i){let e=[],t=i.matched?Ur:$r;return e.push(t.range(i.start.from,i.start.to)),i.end&&e.push(t.range(i.end.from,i.end.to)),e}const Vr=Je.define({create(){return W.none},update(i,e){if(!e.docChanged&&!e.selection)return i;let t=[],r=e.state.facet(Wt);for(let n of e.state.selection.ranges){if(!n.empty)continue;let s=Ae(e.state,n.head,-1,r)||n.head>0&&Ae(e.state,n.head-1,1,r)||r.afterCursor&&(Ae(e.state,n.head,1,r)||n.head<e.state.doc.length&&Ae(e.state,n.head+1,-1,r));s&&(t=t.concat(r.renderMatch(s,e.state)))}return W.set(t,!0)},provide:i=>Q.decorations.from(i)}),Gr=[Vr,jr];function gn(i={}){return[Wt.of(i),Gr]}const Jr=new b;function Ve(i,e,t){let r=i.prop(e<0?b.openedBy:b.closedBy);if(r)return r;if(i.name.length==1){let n=t.indexOf(i.name);if(n>-1&&n%2==(e<0?1:0))return[t[n+e]]}return null}function Ge(i){let e=i.type.prop(Jr);return e?e(i.node):i}function Ae(i,e,t,r={}){let n=r.maxScanDistance||Ft,s=r.brackets||Lt,l=J(i),o=l.resolveInner(e,t);for(let a=o;a;a=a.parent){let f=Ve(a.type,t,s);if(f&&a.from<a.to){let h=Ge(a);if(h&&(t>0?e>=h.from&&e<h.to:e>h.from&&e<=h.to))return Kr(i,e,t,a,h,f,s)}}return Qr(i,e,t,l,o.type,n,s)}function Kr(i,e,t,r,n,s,l){let o=r.parent,a={from:n.from,to:n.to},f=0,h=o?.cursor();if(h&&(t<0?h.childBefore(r.from):h.childAfter(r.to)))do if(t<0?h.to<=r.from:h.from>=r.to){if(f==0&&s.indexOf(h.type.name)>-1&&h.from<h.to){let d=Ge(h);return{start:a,end:d?{from:d.from,to:d.to}:void 0,matched:!0}}else if(Ve(h.type,t,l))f++;else if(Ve(h.type,-t,l)){if(f==0){let d=Ge(h);return{start:a,end:d&&d.from<d.to?{from:d.from,to:d.to}:void 0,matched:!1}}f--}}while(t<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}function Qr(i,e,t,r,n,s,l){let o=t<0?i.sliceDoc(e-1,e):i.sliceDoc(e,e+1),a=l.indexOf(o);if(a<0||a%2==0!=t>0)return null;let f={from:t<0?e-1:e,to:t>0?e+1:e},h=i.doc.iterRange(e,t>0?i.doc.length:0),d=0;for(let g=0;!h.next().done&&g<=s;){let k=h.value;t<0&&(g+=k.length);let w=e+g*t;for(let P=t>0?0:k.length-1,R=t>0?k.length:-1;P!=R;P+=t){let D=l.indexOf(k[P]);if(!(D<0||r.resolveInner(w+P,1).type!=n))if(D%2==0==t>0)d++;else{if(d==1)return{start:f,end:{from:w+P,to:w+P+1},matched:D>>1==a>>1};d--}}t>0&&(g+=k.length)}return h.done?{start:f,matched:!1}:null}const Xr=Object.create(null),dt=[z.none],pt=[],gt=Object.create(null),Yr=Object.create(null);for(let[i,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Yr[i]=Zr(Xr,e);function We(i,e){pt.indexOf(i)>-1||(pt.push(i),console.warn(e))}function Zr(i,e){let t=[];for(let o of e.split(" ")){let a=[];for(let f of o.split(".")){let h=i[f]||c[f];h?typeof h=="function"?a.length?a=a.map(h):We(f,`Modifier ${f} used at start of tag`):a.length?We(f,`Tag ${f} used as modifier`):a=Array.isArray(h)?h:[h]:We(f,`Unknown highlighting tag ${f}`)}for(let f of a)t.push(f)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),n=r+" "+t.map(o=>o.id),s=gt[n];if(s)return s.id;let l=gt[n]=z.define({id:dt.length,name:r,props:[lr({[r]:t})]});return dt.push(l),l.id}nt.RTL,nt.LTR;export{z as A,Gt as D,De as H,Bt as I,sn as L,b as N,er as P,M as T,mr as a,Nt as b,fn as c,dn as d,gn as e,cn as f,yr as g,un as h,kr as i,pn as j,lr as k,$e as l,Ae as m,br as n,ln as o,Tr as p,hn as q,rn as r,J as s,c as t,T as u,on as v,an as w,cr as x,ur as y,bt as z};
